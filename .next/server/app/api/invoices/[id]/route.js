"use strict";(()=>{var e={};e.id=316,e.ids=[316],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6982:(e,t,i)=>{i.r(t),i.d(t,{originalPathname:()=>f,patchFetch:()=>g,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>v,staticGenerationAsyncStorage:()=>m});var s={};i.r(s),i.d(s,{GET:()=>u,PATCH:()=>d});var a=i(9303),n=i(8716),o=i(670),r=i(7070),c=i(748);async function u(e,{params:t}){let{supabase:i,user:s}=await (0,c.n)(e);if(!s)return r.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let{data:a,error:n}=await i.from("invoices").select("*, appointments(*, customers(name), services(name))").eq("id",t.id).single();return n?r.NextResponse.json({error:n.message},{status:404}):r.NextResponse.json(a)}async function d(e,{params:t}){let{supabase:i,user:s}=await (0,c.n)(e);if(!s)return r.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let a=await e.json(),n={};a.status&&(n.status=a.status);let{data:o,error:u}=await i.from("invoices").update(n).eq("id",t.id).select("*").single();if(u)return r.NextResponse.json({error:u.message},{status:400});if("paid"===n.status){let{data:e}=await i.from("invoices").select("id, total, issue_date, appointment_id").eq("id",t.id).single(),s=null;if(e?.appointment_id){let{data:t}=await i.from("appointments").select("customer_id").eq("id",e.appointment_id).single();s=t?.customer_id||null}await i.from("cashflow_transactions").insert({type:"income",category:"client_payment",amount:e?.total||0,transaction_date:new Date().toISOString().slice(0,10),client_id:s,invoice_id:e?.id||null,description:"Recebimento de fatura"})}return r.NextResponse.json(o)}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/invoices/[id]/route",pathname:"/api/invoices/[id]",filename:"route",bundlePath:"app/api/invoices/[id]/route"},resolvedPagePath:"C:\\Users\\Enzo Marcelo\\Desktop\\testes SOLO TRAE\\crm casa limpa\\src\\app\\api\\invoices\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:v}=p,f="/api/invoices/[id]/route";function g(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:m})}},748:(e,t,i)=>{i.d(t,{n:()=>a});var s=i(2305);async function a(e){let t=(0,s.createServerClient)("https://hyygforlvwbbdzpctnid.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5eWdmb3JsdndiYmR6cGN0bmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNjY1NjksImV4cCI6MjA3ODg0MjU2OX0.1ih4fZRYRzg1oqZxAYonDPi5wO2-DHvb7anjcSPWeqs",{cookies:{getAll:()=>e.cookies.getAll(),setAll(t){t.forEach(({name:t,value:i})=>e.cookies.set(t,i))}}}),{data:{user:i}}=await t.auth.getUser();return{supabase:t,user:i}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var i=e=>t(t.s=e),s=t.X(0,[8948,5972,2305],()=>i(6982));module.exports=s})();