"use strict";(()=>{var e={};e.id=7218,e.ids=[7218],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5480:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>x,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var i={};a.r(i),a.d(i,{POST:()=>d});var r=a(9303),n=a(8716),o=a(670),s=a(7070);async function u(e){let t=process.env.HF_ACCESS_TOKEN;if(!t)return null;let a=await fetch("https://api-inference.huggingface.co/models/mistralai/Mistral-7B-Instruct-v0.2",{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({inputs:e,parameters:{max_new_tokens:256,temperature:.7,top_p:.9}})});if(!a.ok)return null;let i=await a.json();return Array.isArray(i)&&i[0]?.generated_text?String(i[0].generated_text):"string"==typeof i?i:JSON.stringify(i)}async function d(e){try{let t=await e.json(),a=t?.messages||[],i=t?.context||{},r=function(e,t){let a=[];if(t){a.push(`Cliente: ${t?.cliente?.name||""}`),a.push(`Servi\xe7o: ${t?.servico?.name||""}`),a.push(`Resid\xeancia: ${t?.residencia||""}`),a.push(`\xc1rea (m\xb2): ${t?.area_m2??""}`),a.push(`Modalidade: ${t?.modalidade||""}`),a.push(`Validade: ${t?.valid_until||""}`),a.push(`Subtotal: ${t?.subtotal??""}`),a.push(`Total: ${t?.total??""}`);let e=Array.isArray(t?.itens)?t.itens.map(e=>`${e.description} x${e.quantity} (R$${Number(e.unit_price||0).toFixed(2)})`).join("; "):"";a.push(`Itens: ${e}`)}let i=e?.find(e=>"user"===e.role)?.content||"";return`Voc\xea \xe9 um assistente de cria\xe7\xe3o de or\xe7amentos da Casa Limpa. D\xea respostas curtas, pr\xe1ticas e acion\xe1veis. N\xe3o invente valores; sugira com base em resid\xeancia, metragem, servi\xe7o, modalidade, itens e totais. Produza tamb\xe9m sugest\xf5es de texto para o template.
Contexto:
${a.join("\n")}
Pergunta:
${i}`}(a,i),n=await u(r);if(n)return s.NextResponse.json({reply:n});let o=function(e,t){let a=e||{},i=Number(a?.area_m2||0),r=String(a?.modalidade||"avulso"),n=`Para ${a?.residencia||"resid\xeancia"} com ${i} m\xb2 e modalidade ${r.toUpperCase()}, sugiro:`,o=i<=60?"at\xe9 2h":i<=120?"2–4h":i<=200?"4–6h":"6h+",s=a?.valid_until||new Date(Date.now()+1296e6).toISOString().slice(0,10),u=`
<p><strong>Condi\xe7\xf5es</strong></p>
<p>Execu\xe7\xe3o estimada: ${o}. Or\xe7amento v\xe1lido at\xe9 ${new Date(s).toLocaleDateString("pt-BR")}.</p>`;return{reply:`${n} Tempo de execu\xe7\xe3o ${o}. Considere incluir itens padr\xe3o, atividades e termos de contrato.`,actions:{setValidUntil:s,addItems:[{description:"Materiais de limpeza",quantity:1,unit:"un",unit_price:50},{description:"Taxa de deslocamento",quantity:1,unit:"un",unit_price:25}],setTemplateAppend:u,setActivities:["Limpeza total do ambiente","Limpeza de portas e batentes","Limpeza de vidros e esquadrias","Higieniza\xe7\xe3o de cozinha e banheiros"],setContractTerms:"Or\xe7amento inclui materiais e equipamentos. Pagamento: 30% de entrada no agendamento e restante na entrega.",setPaymentMethods:["pix"]}}}(i,a?.find(e=>"user"===e.role)?.content);return s.NextResponse.json(o)}catch(e){return s.NextResponse.json({reply:"N\xe3o foi poss\xedvel responder agora. Tente novamente.",error:!0},{status:200})}}let p=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/chatbot/budget/route",pathname:"/api/chatbot/budget",filename:"route",bundlePath:"app/api/chatbot/budget/route"},resolvedPagePath:"C:\\Users\\Enzo Marcelo\\Desktop\\testes SOLO TRAE\\crm casa limpa\\src\\app\\api\\chatbot\\budget\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:c,staticGenerationAsyncStorage:l,serverHooks:m}=p,x="/api/chatbot/budget/route";function g(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[8948,5972],()=>a(5480));module.exports=i})();