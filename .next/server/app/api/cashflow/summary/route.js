"use strict";(()=>{var e={};e.id=7729,e.ids=[7729],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5022:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>d,staticGenerationAsyncStorage:()=>p});var r={};a.r(r),a.d(r,{GET:()=>l});var i=a(9303),o=a(8716),s=a(670),n=a(7070),c=a(748);async function l(e){let t,a;let{supabase:r,user:i}=await (0,c.n)(e);if(!i)return n.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let{searchParams:o}=new URL(e.url),s=o.get("month");if(s&&/^\d{4}-\d{2}$/.test(s)){let[e,r]=s.split("-").map(Number),i=new Date(Date.UTC(e,r-1,1)),o=new Date(Date.UTC(e,r,1));t=i.toISOString().slice(0,10),a=o.toISOString().slice(0,10)}let l=r.from("cashflow_transactions").select("id, type, category, amount, transaction_date, client_id");t&&a&&(l=l.gte("transaction_date",t).lt("transaction_date",a));let{data:u,error:m}=await l;if(m)return n.NextResponse.json({error:m.message},{status:400});let p=(u||[]).filter(e=>"income"===e.type).reduce((e,t)=>e+Number(t.amount||0),0),d=(u||[]).filter(e=>"expense"===e.type).reduce((e,t)=>e+Number(t.amount||0),0),f={};(u||[]).filter(e=>"expense"===e.type).forEach(e=>{let t=e.category||"outros";f[t]=(f[t]||0)+Number(e.amount||0)});let h=[],y=Array.from(new Set((u||[]).filter(e=>"income"===e.type&&e.client_id).map(e=>e.client_id)));if(y.length>0){let{data:e}=await r.from("customers").select("id, name").in("id",y),t={};(u||[]).filter(e=>"income"===e.type&&e.client_id).forEach(e=>{let a=e.client_id;t[a]=(t[a]||0)+Number(e.amount||0)}),(h=(e||[]).map(e=>({client_id:e.id,name:e.name,total:t[e.id]||0}))).sort((e,t)=>t.total-e.total)}return n.NextResponse.json({month:s,summary:{income:p,expense:d,net:p-d},expenseByCategory:f,incomeByClient:h})}let u=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/cashflow/summary/route",pathname:"/api/cashflow/summary",filename:"route",bundlePath:"app/api/cashflow/summary/route"},resolvedPagePath:"C:\\Users\\Enzo Marcelo\\Desktop\\testes SOLO TRAE\\crm casa limpa\\src\\app\\api\\cashflow\\summary\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:d}=u,f="/api/cashflow/summary/route";function h(){return(0,s.patchFetch)({serverHooks:d,staticGenerationAsyncStorage:p})}},748:(e,t,a)=>{a.d(t,{n:()=>i});var r=a(2305);async function i(e){let t=(0,r.createServerClient)("https://hyygforlvwbbdzpctnid.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5eWdmb3JsdndiYmR6cGN0bmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNjY1NjksImV4cCI6MjA3ODg0MjU2OX0.1ih4fZRYRzg1oqZxAYonDPi5wO2-DHvb7anjcSPWeqs",{cookies:{getAll:()=>e.cookies.getAll(),setAll(t){t.forEach(({name:t,value:a})=>e.cookies.set(t,a))}}}),{data:{user:a}}=await t.auth.getUser();return{supabase:t,user:a}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[8948,5972,2305],()=>a(5022));module.exports=r})();