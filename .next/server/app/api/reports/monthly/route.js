"use strict";(()=>{var e={};e.id=2837,e.ids=[2837],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},773:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>d});var s={};r.r(s),r.d(s,{GET:()=>p});var a=r(9303),o=r(8716),n=r(670),i=r(7070),l=r(748);async function p(e){let{supabase:t,user:r}=await (0,l.n)(e);if(!r)return i.NextResponse.json({error:"N\xe3o autenticado"},{status:401});let{searchParams:s}=new URL(e.url),a=s.get("month"),o=t.from("appointments").select("id, appointment_date, status, price"),n=t.from("invoices").select("id, issue_date, status, total");a&&(o=o.like("appointment_date",`${a}%`),n=n.like("issue_date",`${a}%`));let[{data:p,error:u},{data:c,error:d}]=await Promise.all([o,n]);if(u||d){let e=u?.message||d?.message||"Erro ao gerar relat\xf3rio";return i.NextResponse.json({error:e},{status:400})}let m=p?.length??0,h=p?.filter(e=>"completed"===e.status).length??0,g=p?.filter(e=>"cancelled"===e.status).length??0,v=p?.reduce((e,t)=>e+Number(t.price||0),0)??0,f=c?.length??0,I=c?.filter(e=>"paid"===e.status).length??0,j=c?.reduce((e,t)=>e+Number(t.total||0),0)??0;return i.NextResponse.json({month:a,jobs:{total:m,done:h,cancelled:g,revenue:v},invoices:{total:f,paid:I,revenue:j},totals:{revenue:j}})}let u=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/reports/monthly/route",pathname:"/api/reports/monthly",filename:"route",bundlePath:"app/api/reports/monthly/route"},resolvedPagePath:"C:\\Users\\Enzo Marcelo\\Desktop\\testes SOLO TRAE\\crm casa limpa\\src\\app\\api\\reports\\monthly\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:c,staticGenerationAsyncStorage:d,serverHooks:m}=u,h="/api/reports/monthly/route";function g(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:d})}},748:(e,t,r)=>{r.d(t,{n:()=>a});var s=r(2305);async function a(e){let t=(0,s.createServerClient)("https://hyygforlvwbbdzpctnid.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5eWdmb3JsdndiYmR6cGN0bmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNjY1NjksImV4cCI6MjA3ODg0MjU2OX0.1ih4fZRYRzg1oqZxAYonDPi5wO2-DHvb7anjcSPWeqs",{cookies:{getAll:()=>e.cookies.getAll(),setAll(t){t.forEach(({name:t,value:r})=>e.cookies.set(t,r))}}}),{data:{user:r}}=await t.auth.getUser();return{supabase:t,user:r}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[8948,5972,2305],()=>r(773));module.exports=s})();