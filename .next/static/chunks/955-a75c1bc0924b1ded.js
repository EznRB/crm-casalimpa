"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[955],{1066:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(2265),o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),i=(e,t)=>{let n=(0,r.forwardRef)((n,i)=>{let{color:s="currentColor",size:c=24,strokeWidth:u=2,absoluteStrokeWidth:l,className:f="",children:d,...m}=n;return(0,r.createElement)("svg",{ref:i,...o,width:c,height:c,stroke:s,strokeWidth:l?24*Number(u)/Number(c):u,className:["lucide","lucide-".concat(a(e)),f].join(" "),...m},[...t.map(e=>{let[t,n]=e;return(0,r.createElement)(t,n)}),...Array.isArray(d)?d:[d]])});return n.displayName="".concat(e),n}},9322:function(e,t,n){n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(1066).Z)("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]])},518:function(e,t,n){n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(1066).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},1216:function(e,t,n){n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(1066).Z)("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]])},2513:function(e,t,n){n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(1066).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},9061:function(e,t,n){n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(1066).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},5637:function(e,t,n){n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(1066).Z)("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]])},4697:function(e,t,n){n.d(t,{Z:function(){return r}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,n(1066).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},9875:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(7437),o=n(2265);function a(e){let[t,n]=(0,o.useState)(!1),[a,i]=(0,o.useState)(""),[s,c]=(0,o.useState)(!1),[u,l]=(0,o.useState)([]),f=async()=>{if(!a.trim())return;let t=[...u,{role:"user",content:a}];l(t),c(!0);try{let n=await fetch("/api/chatbot/budget",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:[{role:"user",content:a}],context:e.context})}),r=await n.json(),o=String((null==r?void 0:r.reply)||"Sem resposta no momento.");l([...t,{role:"assistant",content:o,actions:null==r?void 0:r.actions}])}catch(e){l([...t,{role:"assistant",content:"Falha ao responder. Tente novamente."}])}finally{c(!1),i("")}},d=t=>{if(t){if(t.setValidUntil&&e.onSetValidUntil&&e.onSetValidUntil(t.setValidUntil),Array.isArray(t.addItems)&&e.onAddItem)for(let n of t.addItems)e.onAddItem(n);t.setTemplateAppend&&e.onSetTemplateAppend&&e.onSetTemplateAppend(t.setTemplateAppend),Array.isArray(t.setActivities)&&e.onSetActivities&&e.onSetActivities(t.setActivities),"string"==typeof t.setContractTerms&&e.onSetContractTerms&&e.onSetContractTerms(t.setContractTerms),Array.isArray(t.setPaymentMethods)&&e.onSetPaymentMethods&&e.onSetPaymentMethods(t.setPaymentMethods)}};return(0,r.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:t?(0,r.jsxs)("div",{className:"w-[320px] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("span",{className:"font-medium",children:"Assistente de Or\xe7amento"}),(0,r.jsx)("button",{onClick:()=>n(!1),className:"text-gray-500",children:"✕"})]}),(0,r.jsxs)("div",{className:"h-64 overflow-y-auto px-3 py-2 space-y-2",children:[u.map((e,t)=>(0,r.jsxs)("div",{className:"user"===e.role?"text-right":"text-left",children:[(0,r.jsx)("div",{className:"inline-block px-3 py-2 rounded ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 dark:text-gray-100"),children:e.content}),"assistant"===e.role&&e.actions&&(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)("button",{onClick:()=>d(e.actions),className:"text-sm bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-2 py-1 rounded",children:"Aplicar sugest\xe3o"})})]},t)),0===u.length&&(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Fa\xe7a perguntas como “sugira itens”, “defina validade”, “preencha texto do template”."})]}),(0,r.jsx)("div",{className:"px-3 py-2 border-t border-gray-200 dark:border-gray-700",children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{value:a,onChange:e=>i(e.target.value),placeholder:"Digite sua pergunta",className:"flex-1 border rounded px-2 py-2"}),(0,r.jsx)("button",{onClick:f,disabled:s,className:"bg-blue-600 text-white px-3 py-2 rounded",children:s?"...":"Enviar"})]})})]}):(0,r.jsx)("button",{onClick:()=>n(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow",children:"Ajuda"})})}},8493:function(e,t,n){n.d(t,{$J:function(){return x},A9:function(){return I},BX:function(){return S},By:function(){return g},CF:function(){return h},FG:function(){return d},G6:function(){return u},HG:function(){return N},J5:function(){return C},KB:function(){return _},LA:function(){return a},OL:function(){return o},Ol:function(){return P},Ov:function(){return f},P6:function(){return q},Pc:function(){return b},Pg:function(){return l},QR:function(){return Z},Rt:function(){return A},Ts:function(){return w},U2:function(){return s},UO:function(){return M},V2:function(){return y},Z$:function(){return p},fN:function(){return v},fg:function(){return O},h4:function(){return J},hH:function(){return k},np:function(){return U},p9:function(){return m},r8:function(){return j},tI:function(){return E},tt:function(){return T},wK:function(){return i},wo:function(){return c},xd:function(){return D},yo:function(){return R}});var r=n(4316);async function o(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e,error:t}=await r.O.from("customers").select("*").order("name");if(t)throw t;return e||[]}async function a(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{error:t}=await r.O.from("customers").delete().eq("id",e);if(t)throw t}async function i(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("customers").insert([e]).select("*").single();if(n)throw n;return t}async function s(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e,error:t}=await r.O.from("services").select("*").order("name");if(t)throw t;return e||[]}async function c(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{error:t}=await r.O.from("services").delete().eq("id",e);if(t)throw t}async function u(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("services").insert([e]).select("*").single();if(n)throw n;return t}async function l(e,t){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:n,error:o}=await r.O.from("services").update(t).eq("id",e).select("*").single();if(o)throw o;return n}async function f(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e,error:t}=await r.O.from("invoices").select("\n      id,\n      invoice_number,\n      issue_date,\n      due_date,\n      subtotal,\n      tax,\n      total,\n      status,\n      pdf_url,\n      appointments ( customers (name), services (name) )\n    ").order("issue_date",{ascending:!1});if(t)throw t;return e||[]}async function d(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("invoices").select("\n      id,\n      invoice_number,\n      issue_date,\n      due_date,\n      subtotal,\n      tax,\n      total,\n      status,\n      pdf_url,\n      appointments ( customers (name), services (name) )\n    ").eq("id",e).single();if(n)throw n;return t||null}async function m(e){if(!r.O)throw Error("Supabase n\xe3o configurado");if(!e||0===e.length)return[];let{data:t,error:n}=await r.O.from("invoices").select("appointment_id").in("appointment_id",e);if(n)throw n;return t||[]}async function p(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("invoices").insert([e]).select("*").single();if(n)throw n;return t}async function h(e,t){let n=await fetch("/api/invoices/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Falha ao atualizar fatura")}}async function w(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e,error:t}=await r.O.from("appointments").select("*, customers (name, phone), services (name, duration_minutes)");if(t)throw t;return e||[]}async function y(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{error:t}=await r.O.from("appointments").delete().eq("id",e);if(t)throw t}async function g(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e,error:t}=await r.O.from("appointments").select("*");if(t)throw t;return e||[]}async function b(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("appointments").insert([e]).select("*").single();if(n)throw n;return t}async function O(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e,error:t}=await r.O.from("appointments").select("*, customers (name, phone, email), services (name, duration_minutes)");if(t)throw t;return e||[]}async function S(e){let t,n;if(!r.O)throw Error("Supabase n\xe3o configurado");if(e&&/^\d{4}-\d{2}$/.test(e)){let[r,o]=e.split("-").map(Number),a=new Date(Date.UTC(r,o-1,1)),i=new Date(Date.UTC(r,o,1));t=a.toISOString().slice(0,10),n=i.toISOString().slice(0,10)}let o=r.O.from("cashflow_transactions").select("id, type, category, amount, transaction_date, client_id");t&&n&&(o=o.gte("transaction_date",t).lt("transaction_date",n));let{data:a,error:i}=await o;if(i)throw i;let s=(a||[]).filter(e=>"income"===e.type).reduce((e,t)=>e+Number(t.amount||0),0),c=(a||[]).filter(e=>"expense"===e.type).reduce((e,t)=>e+Number(t.amount||0),0),u={};(a||[]).filter(e=>"expense"===e.type).forEach(e=>{let t=e.category||"outros";u[t]=(u[t]||0)+Number(e.amount||0)});let l=[],f=Array.from(new Set((a||[]).filter(e=>"income"===e.type&&e.client_id).map(e=>e.client_id)));if(f.length>0){let{data:e}=await r.O.from("customers").select("id, name").in("id",f),t={};(a||[]).filter(e=>"income"===e.type&&e.client_id).forEach(e=>{let n=e.client_id;t[n]=(t[n]||0)+Number(e.amount||0)}),(l=(e||[]).map(e=>({client_id:e.id,name:e.name,total:t[e.id]||0}))).sort((e,t)=>t.total-e.total)}return{month:e||null,summary:{income:s,expense:c,net:s-c},expenseByCategory:u,incomeByClient:l}}async function x(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let t={type:"expense",category:e.category||"other",amount:Number(e.amount||0),transaction_date:(e.date||new Date().toISOString()).slice(0,10),description:e.description||null};if(!t.amount||t.amount<=0)throw Error("Valor inv\xe1lido");let{data:n,error:o}=await r.O.from("cashflow_transactions").insert(t).select("*").single();if(o)throw o;return n}async function v(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e,error:t}=await r.O.from("employees").select("*");if(t)throw t;return e||[]}async function k(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("employee_work_records").select("*").eq("employeeId",e);if(n)throw n;return t||[]}async function E(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e}=await r.O.from("company").select("*").single();return e||null}async function _(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("employees").select("*").eq("id",e).single();if(n)throw n;return t||null}async function j(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let t=(e.cpf||"").toString().replace(/\D/g,"");if(!t)throw Error("CPF inv\xe1lido");let{data:n}=await r.O.from("employees").select("id").eq("cpf",t).limit(1);if(n&&n.length>0)throw Error("CPF j\xe1 cadastrado");let{error:o}=await r.O.from("employees").insert([{...e,cpf:t}]);if(o)throw o}async function N(e,t){if(!r.O)throw Error("Supabase n\xe3o configurado");let n=(t.cpf||"").toString().replace(/\D/g,"");if(n){let{data:t}=await r.O.from("employees").select("id").eq("cpf",n).neq("id",e).limit(1);if(t&&t.length>0)throw Error("CPF j\xe1 cadastrado")}let{error:o}=await r.O.from("employees").update({...t,cpf:n||t.cpf}).eq("id",e);if(o)throw o}async function q(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{error:t}=await r.O.from("employees").delete().eq("id",e);if(t)throw t}async function C(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let t={employeeId:e.employeeId,workDate:e.workDate,workDays:e.workDays,dailyRate:e.dailyRate,totalAmount:Number(e.dailyRate||0)*Number(e.workDays||0),notes:e.notes||null,paid:!1},{error:n}=await r.O.from("employee_work_records").insert([t]);if(n)throw n}async function A(e,t){let n=await fetch("/api/employees/work-records/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({paid:t})});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error((null==e?void 0:e.error)||"Falha ao atualizar registro de trabalho")}}async function I(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let t={name:e.name,cnpj:e.cnpj,phone:e.phone,email:e.email,address:e.address,bank_info:e.bank_info,logo_url:e.logo_url,updated_at:new Date().toISOString()};if(e.id){let{data:n,error:o}=await r.O.from("company").update(t).eq("id",e.id).select("*").single();if(o)throw o;return n}{let{data:e,error:n}=await r.O.from("company").insert(t).select("*").single();if(n)throw n;return e}}async function Z(){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:e,error:t}=await r.O.from("quotes").select("*, customers (name, phone), services (name)");if(t){if("PGRST205"===t.code)return[];throw t}return(e||[]).sort((e,t)=>(t.created_at||"").localeCompare(e.created_at||""))}async function T(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("quotes").select("*, customers (*), services (*), quote_items (*), quote_images (*)").eq("id",e).single();if(n){if("PGRST205"===n.code)return null;throw n}return t||null}async function P(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("quotes").insert([e]).select("*").single();if(n)throw n;return t}async function D(e,t){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:n,error:o}=await r.O.from("quotes").update(t).eq("id",e).select("*").single();if(o)throw o;return n}async function M(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{error:t}=await r.O.from("quotes").delete().eq("id",e);if(t)throw t}async function J(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:t,error:n}=await r.O.from("quote_items").insert([e]).select("*").single();if(n)throw n;return t}async function R(e,t){if(!r.O)throw Error("Supabase n\xe3o configurado");let{data:n,error:o}=await r.O.from("quote_items").update(t).eq("id",e).select("*").single();if(o)throw o;return n}async function U(e){if(!r.O)throw Error("Supabase n\xe3o configurado");let{error:t}=await r.O.from("quote_items").delete().eq("id",e);if(t)throw t}},4316:function(e,t,n){n.d(t,{O:function(){return i}});var r=n(4170);let o="https://hyygforlvwbbdzpctnid.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh5eWdmb3JsdndiYmR6cGN0bmlkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMyNjY1NjksImV4cCI6MjA3ODg0MjU2OX0.1ih4fZRYRzg1oqZxAYonDPi5wO2-DHvb7anjcSPWeqs",i="string"==typeof o&&"string"==typeof a&&o.startsWith("https://")&&o.includes(".supabase.co")&&!o.includes("example.supabase.co")&&a.length>20?(0,r.createBrowserClient)(o,a):null}}]);