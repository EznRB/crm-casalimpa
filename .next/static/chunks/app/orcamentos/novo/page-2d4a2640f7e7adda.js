(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[673],{5256:function(e,t,a){Promise.resolve().then(a.bind(a,2610))},2610:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(7437),l=a(2265),n=a(7138),r=a(8493),i=a(518),d=a(9061),c=a(9322),o=a(1216),u=a(5637),m=a(2513),x=a(4697),p=a(9875);function h(){let[e,t]=(0,l.useState)([]),[a,h]=(0,l.useState)([]),[g,v]=(0,l.useState)(""),[j,b]=(0,l.useState)(""),[N,y]=(0,l.useState)("casa"),[f,w]=(0,l.useState)(0),[C,S]=(0,l.useState)("avulso"),[_,k]=(0,l.useState)(""),[M,q]=(0,l.useState)(0),[E,T]=(0,l.useState)(0),[O,R]=(0,l.useState)(""),[A,I]=(0,l.useState)([]),[L,Z]=(0,l.useState)(""),D=(0,l.useRef)(null),[z,U]=(0,l.useState)(!1),[V,B]=(0,l.useState)(""),[F,H]=(0,l.useState)(""),[P,Q]=(0,l.useState)(""),[$,G]=(0,l.useState)(""),[J,K]=(0,l.useState)([]),[W,X]=(0,l.useState)(""),[Y,ee]=(0,l.useState)([]),[et,ea]=(0,l.useState)("");(0,l.useEffect)(()=>{(async()=>{try{let[e,a]=await Promise.all([(0,r.OL)(),(0,r.U2)()]);t(e||[]),h(a||[])}catch(e){console.error("Erro ao carregar dados base:",e),alert("Erro ao carregar clientes/servi\xe7os")}})()},[]);let es=(0,l.useMemo)(()=>A.reduce((e,t)=>e+Number(t.unit_price||0)*Number(t.quantity||0),0),[A]),el=(0,l.useMemo)(()=>{let e=Math.max(0,Math.min(Number(M||0),es));return es-e+Math.max(0,Number(E||0))},[es,M,E]),en=(0,l.useMemo)(()=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}),[]),er=(0,l.useMemo)(()=>!!(g&&j&&N&&f>0&&C),[g,j,N,f,C]),ei=e=>{I(A.filter((t,a)=>a!==e))},ed=e=>{var t;document.execCommand(e),Z((null===(t=D.current)||void 0===t?void 0:t.innerHTML)||"")},ec=()=>{let t=e.find(e=>e.id===g),s=a.find(e=>e.id===j);return"\n      <p><strong>Or\xe7amento de Servi\xe7o</strong></p>\n      <p>Cliente: ".concat((null==t?void 0:t.name)||"","</p>\n      <p>Servi\xe7o: ").concat((null==s?void 0:s.name)||"","</p>\n      <p>Resid\xeancia: ").concat(N.toUpperCase()," — \xc1rea: ").concat(f," m\xb2</p>\n      <p>Modalidade: ").concat(C.toUpperCase(),"</p>\n      <p>Validade: ").concat(_?new Date(_).toLocaleDateString("pt-BR"):"—","</p>\n      <p>Itens e valores conforme tabela.</p>\n    ")},eo=async()=>{if(!g){alert("Selecione um cliente");return}if(!j){alert("Selecione um servi\xe7o");return}if(!(f>0)){alert("Informe a \xe1rea em m\xb2");return}U(!0);try{let e={title:V||"Or\xe7amento",customer_id:g,service_id:j,residence_type:N,area_m2:Number(f||0),service_modality:C,valid_until:_||null,discount:Number(M||0),taxes:Number(E||0),subtotal:Number(es||0),total:Number(el||0),status:"rascunho",notes:O||null,rich_content:{html:L||ec()},initial_report:$||null,activities:J.length?J:null,payment_methods:Y.length?Y:null,contract_terms:et||null,client_label:F||null,client_subtitle:P||null},t=await (0,r.Ol)(e);for(let e of A)await (0,r.h4)({quote_id:t.id,description:e.description,quantity:Number(e.quantity||0),unit:e.unit||"un",unit_price:Number(e.unit_price||0),total:Number(e.unit_price||0)*Number(e.quantity||0)});alert("Or\xe7amento criado com sucesso!"),window.location.href="/orcamentos/".concat(t.id)}catch(e){console.error("Erro ao salvar or\xe7amento:",e),alert("Erro ao salvar or\xe7amento")}finally{U(!1)}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(n.default,{href:"/orcamentos",className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[(0,s.jsx)(i.Z,{className:"w-4 h-4"}),"Voltar"]})}),(0,s.jsxs)("button",{onClick:eo,disabled:z||!er,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 disabled:opacity-60",children:[(0,s.jsx)(d.Z,{className:"w-4 h-4"}),"Salvar Or\xe7amento"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"T\xedtulo do servi\xe7o"}),(0,s.jsx)("input",{value:V,onChange:e=>B(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",placeholder:"Ex.: Limpeza p\xf3s obra"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Cliente"}),(0,s.jsxs)("select",{value:g,onChange:e=>v(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"",children:"Selecione..."}),e.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"R\xf3tulo do cliente"}),(0,s.jsx)("input",{value:F,onChange:e=>H(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",placeholder:"Ex.: Arquiteta Fl\xe1via"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Subt\xedtulo"}),(0,s.jsx)("input",{value:P,onChange:e=>Q(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",placeholder:"Ex.: Condom\xednio ..."})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Servi\xe7o"}),(0,s.jsxs)("select",{value:j,onChange:e=>b(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"",children:"Selecione..."}),a.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Tipo de resid\xeancia"}),(0,s.jsxs)("select",{value:N,onChange:e=>y(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"casa",children:"Casa"}),(0,s.jsx)("option",{value:"apartamento",children:"Apartamento"}),(0,s.jsx)("option",{value:"comercial",children:"Comercial"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\xc1rea (m\xb2)"}),(0,s.jsx)("input",{type:"number",value:f,onChange:e=>w(Number(e.target.value)),className:"mt-1 w-full border rounded-lg px-3 py-2"}),!f&&(0,s.jsx)("div",{className:"text-xs text-red-600 mt-1",children:"Informe a \xe1rea em m\xb2"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Modalidade"}),(0,s.jsxs)("select",{value:C,onChange:e=>S(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"avulso",children:"Avulso"}),(0,s.jsx)("option",{value:"mensal",children:"Mensal"}),(0,s.jsx)("option",{value:"semanal",children:"Semanal"}),(0,s.jsx)("option",{value:"quinzenal",children:"Quinzenal"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Validade"}),(0,s.jsx)("input",{type:"date",value:_,onChange:e=>k(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Relat\xf3rio Inicial"}),(0,s.jsx)("textarea",{value:$,onChange:e=>G(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",rows:5,placeholder:"Descreva o contexto do servi\xe7o..."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>ed("bold"),className:"px-2 py-1 border rounded",children:(0,s.jsx)(c.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{type:"button",onClick:()=>ed("italic"),className:"px-2 py-1 border rounded",children:(0,s.jsx)(o.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{type:"button",onClick:()=>ed("underline"),className:"px-2 py-1 border rounded",children:(0,s.jsx)(u.Z,{className:"w-4 h-4"})})]}),(0,s.jsx)("div",{ref:D,contentEditable:!0,onInput:()=>{var e;Z((null===(e=D.current)||void 0===e?void 0:e.innerHTML)||"")},className:"min-h-[160px] border rounded-lg p-3 focus:outline-none",dangerouslySetInnerHTML:{__html:L||ec()}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Observa\xe7\xf5es"}),(0,s.jsx)("textarea",{value:O,onChange:e=>R(e.target.value),className:"mt-1 w-full border rounded-lg px-3 py-2",rows:3})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-4 border-b flex justify-between items-center",children:(0,s.jsx)("span",{className:"font-medium",children:"Descri\xe7\xe3o das atividades"})}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:W,onChange:e=>X(e.target.value),className:"flex-1 border rounded px-2 py-2",placeholder:"Ex.: Limpeza total do apartamento"}),(0,s.jsx)("button",{onClick:()=>{W.trim()&&(K([...J,W.trim()]),X(""))},className:"bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded",children:"Adicionar"})]}),(0,s.jsx)("ul",{className:"list-disc pl-6 space-y-1",children:J.map((e,t)=>(0,s.jsxs)("li",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("button",{onClick:()=>K(J.filter((e,a)=>a!==t)),className:"text-red-600 text-sm",children:"Remover"})]},t))})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,s.jsx)("span",{className:"font-medium",children:"Itens do or\xe7amento"}),(0,s.jsxs)("button",{onClick:()=>{I([...A,{description:"",quantity:1,unit:"un",unit_price:0}])},className:"bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"w-4 h-4"}),"Adicionar item"]})]}),(0,s.jsx)("div",{className:"p-4 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Descri\xe7\xe3o"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Qtd"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Unidade"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Valor unit\xe1rio"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"A\xe7\xf5es"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:A.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("input",{value:e.description,onChange:e=>{let a=e.target.value,s=[...A];s[t].description=a,I(s)},className:"w-full border rounded px-2 py-1"})}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("input",{type:"number",value:e.quantity,onChange:e=>{let a=Number(e.target.value),s=[...A];s[t].quantity=a,I(s)},className:"w-full border rounded px-2 py-1"})}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("input",{value:e.unit,onChange:e=>{let a=e.target.value,s=[...A];s[t].unit=a,I(s)},className:"w-full border rounded px-2 py-1"})}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("input",{type:"number",value:e.unit_price,onChange:e=>{let a=Number(e.target.value),s=[...A];s[t].unit_price=a,I(s)},className:"w-full border rounded px-2 py-1"})}),(0,s.jsxs)("td",{className:"px-3 py-2 text-sm",children:["R$ ",(Number(e.unit_price||0)*Number(e.quantity||0)).toFixed(2)]}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsxs)("button",{onClick:()=>ei(t),className:"text-red-600 hover:text-red-800 flex items-center gap-1",children:[(0,s.jsx)(x.Z,{className:"w-4 h-4"})," Remover"]})})]},t))})]})}),(0,s.jsxs)("div",{className:"p-4 border-t grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Desconto"}),(0,s.jsx)("input",{type:"number",value:M,onChange:e=>q(Number(e.target.value)),className:"mt-1 w-full border rounded-lg px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Taxas"}),(0,s.jsx)("input",{type:"number",value:E,onChange:e=>T(Number(e.target.value)),className:"mt-1 w-full border rounded-lg px-3 py-2"})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-sm",children:["Subtotal: ",(0,s.jsx)("strong",{children:en.format(es)})]}),(0,s.jsxs)("div",{className:"text-sm",children:["Desconto: ",(0,s.jsx)("strong",{children:en.format(Math.max(0,Math.min(Number(M||0),es)))})]}),(0,s.jsxs)("div",{className:"text-sm",children:["Taxas: ",(0,s.jsx)("strong",{children:en.format(Math.max(0,Number(E||0)))})]}),(0,s.jsxs)("div",{className:"text-lg",children:["Total: ",(0,s.jsx)("strong",{children:en.format(el)})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsx)("span",{className:"font-medium",children:"M\xe9todos de pagamento"})}),(0,s.jsx)("div",{className:"p-4 grid grid-cols-2 md:grid-cols-4 gap-2",children:["pix","transferencia","cartao","dinheiro"].map(e=>(0,s.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:Y.includes(e),onChange:t=>ee(a=>t.target.checked?[...a,e]:a.filter(t=>t!==e))}),(0,s.jsx)("span",{className:"capitalize",children:e})]},e))})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsx)("span",{className:"font-medium",children:"Condi\xe7\xf5es de contrato"})}),(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)("textarea",{value:et,onChange:e=>ea(e.target.value),className:"w-full border rounded px-3 py-2",rows:4,placeholder:"Ex.: Or\xe7amento inclui materiais e equipamentos; 30% de entrada..."})})]}),(0,s.jsx)(p.Z,{context:{titulo:V,cliente:e.find(e=>e.id===g)||void 0,servico:a.find(e=>e.id===j)||void 0,residencia:N,area_m2:f,modalidade:C,valid_until:_||null,itens:A.map(e=>({description:e.description,quantity:e.quantity,unit:e.unit,unit_price:e.unit_price})),subtotal:es,total:el},onSetValidUntil:e=>k(e),onAddItem:e=>I(t=>[...t,{description:e.description,quantity:e.quantity,unit:e.unit||"un",unit_price:e.unit_price}]),onSetTemplateAppend:e=>Z(t=>(t||ec())+e),onSetActivities:e=>K(e),onSetContractTerms:e=>ea(e),onSetPaymentMethods:e=>ee(e)})]})}}},function(e){e.O(0,[46,170,138,955,971,23,744],function(){return e(e.s=5256)}),_N_E=e.O()}]);