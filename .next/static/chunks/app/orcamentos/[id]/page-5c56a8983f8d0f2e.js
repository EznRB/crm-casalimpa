(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[296],{1932:function(e,t,a){Promise.resolve().then(a.bind(a,8454))},2023:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(1066).Z)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},6463:function(e,t,a){"use strict";var s=a(1169);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},8454:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return b}});var s=a(7437),l=a(2265),i=a(6463),r=a(7138),n=a(8493),d=a(4316),c=a(518),o=a(2023),u=a(9061),m=a(9322),x=a(1216),p=a(5637),h=a(2513),v=a(4697),y=a(9875);function b(){var e;let t=(0,i.useParams)(),a=null==t?void 0:t.id,[b,g]=(0,l.useState)(!0),[N,j]=(0,l.useState)(!1),[f,_]=(0,l.useState)(null),[w,C]=(0,l.useState)([]),k=(0,l.useRef)(null),[q,M]=(0,l.useState)(""),[S,A]=(0,l.useState)(""),[T,Z]=(0,l.useState)([]),[P,E]=(0,l.useState)(!1);(0,l.useEffect)(()=>{a&&(async()=>{try{var e;let t=await (0,n.tt)(a);_(t),C((null==t?void 0:t.quote_items)||[]),M((null==t?void 0:null===(e=t.rich_content)||void 0===e?void 0:e.html)||"");let s=(null==t?void 0:t.payment_methods)||[];Z(Array.isArray(s)?s:[])}catch(e){console.error("Erro ao carregar or\xe7amento:",e),alert("Erro ao carregar or\xe7amento")}finally{g(!1)}})()},[a]);let O=(0,l.useMemo)(()=>w.reduce((e,t)=>e+Number(t.unit_price||0)*Number(t.quantity||0),0),[w]),R=(0,l.useMemo)(()=>{let e=Math.max(0,Math.min(Number((null==f?void 0:f.discount)||0),O));return O-e+Math.max(0,Number((null==f?void 0:f.taxes)||0))},[O,null==f?void 0:f.discount,null==f?void 0:f.taxes]),I=(0,l.useMemo)(()=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}),[]),z=e=>{var t;document.execCommand(e),M((null===(t=k.current)||void 0===t?void 0:t.innerHTML)||"")},H=async()=>{C([...w,{description:"",quantity:1,unit:"un",unit_price:0,total:0}])},D=async()=>{if(f){j(!0);try{let e={residence_type:f.residence_type,area_m2:Number(f.area_m2||0),service_modality:f.service_modality,valid_until:f.valid_until||null,discount:Number(f.discount||0),taxes:Number(f.taxes||0),subtotal:Number(O||0),total:Number(R||0),status:f.status,notes:f.notes||null,rich_content:{html:q},title:f.title||"Or\xe7amento",initial_report:f.initial_report||null,activities:Array.isArray(f.activities)?f.activities:null,payment_methods:T.length?T:null,contract_terms:f.contract_terms||null,client_label:f.client_label||null,client_subtitle:f.client_subtitle||null};for(let t of(await (0,n.xd)(f.id,e),w))t.id?await (0,n.yo)(t.id,{description:t.description,quantity:Number(t.quantity||0),unit:t.unit||"un",unit_price:Number(t.unit_price||0),total:Number(t.unit_price||0)*Number(t.quantity||0)}):await (0,n.h4)({quote_id:f.id,description:t.description,quantity:Number(t.quantity||0),unit:t.unit||"un",unit_price:Number(t.unit_price||0),total:Number(t.unit_price||0)*Number(t.quantity||0)});alert("Or\xe7amento atualizado!")}catch(e){console.error("Erro ao salvar or\xe7amento:",e),alert("Erro ao salvar or\xe7amento")}finally{j(!1)}}},V=async e=>{let t=w[e];if(C(w.filter((t,a)=>a!==e)),null==t?void 0:t.id)try{await (0,n.np)(t.id)}catch(e){console.error(e)}};return b?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):f?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(r.default,{href:"/orcamentos",className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[(0,s.jsx)(c.Z,{className:"w-4 h-4"})," Voltar"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(r.default,{href:"/api/orcamentos/".concat(f.id,"/pdf"),target:"_blank",className:"bg-gray-100 px-3 py-2 rounded hover:bg-gray-200 flex items-center gap-2",children:[(0,s.jsx)(o.Z,{className:"w-4 h-4"})," PDF"]}),(0,s.jsxs)("button",{onClick:D,disabled:N,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2 disabled:opacity-60",children:[(0,s.jsx)(u.Z,{className:"w-4 h-4"})," Salvar"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Tipo de resid\xeancia"}),(0,s.jsxs)("select",{value:f.residence_type,onChange:e=>_({...f,residence_type:e.target.value}),className:"mt-1 w-full border rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"casa",children:"Casa"}),(0,s.jsx)("option",{value:"apartamento",children:"Apartamento"}),(0,s.jsx)("option",{value:"comercial",children:"Comercial"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"\xc1rea (m\xb2)"}),(0,s.jsx)("input",{type:"number",value:f.area_m2||0,onChange:e=>_({...f,area_m2:Number(e.target.value)}),className:"mt-1 w-full border rounded-lg px-3 py-2"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Modalidade"}),(0,s.jsxs)("select",{value:f.service_modality,onChange:e=>_({...f,service_modality:e.target.value}),className:"mt-1 w-full border rounded-lg px-3 py-2",children:[(0,s.jsx)("option",{value:"avulso",children:"Avulso"}),(0,s.jsx)("option",{value:"mensal",children:"Mensal"}),(0,s.jsx)("option",{value:"semanal",children:"Semanal"}),(0,s.jsx)("option",{value:"quinzenal",children:"Quinzenal"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Validade"}),(0,s.jsx)("input",{type:"date",value:f.valid_until||"",onChange:e=>_({...f,valid_until:e.target.value}),className:"mt-1 w-full border rounded-lg px-3 py-2"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Relat\xf3rio Inicial"}),(0,s.jsx)("textarea",{value:(null==f?void 0:f.initial_report)||"",onChange:e=>_({...f,initial_report:e.target.value}),className:"mt-1 w-full border rounded-lg px-3 py-2",rows:5})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{type:"button",onClick:()=>z("bold"),className:"px-2 py-1 border rounded",children:(0,s.jsx)(m.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{type:"button",onClick:()=>z("italic"),className:"px-2 py-1 border rounded",children:(0,s.jsx)(x.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{type:"button",onClick:()=>z("underline"),className:"px-2 py-1 border rounded",children:(0,s.jsx)(p.Z,{className:"w-4 h-4"})})]}),(0,s.jsx)("div",{ref:k,contentEditable:!0,onInput:()=>{var e;M((null===(e=k.current)||void 0===e?void 0:e.innerHTML)||"")},className:"min-h-[160px] border rounded-lg p-3 focus:outline-none",dangerouslySetInnerHTML:{__html:q}}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Observa\xe7\xf5es"}),(0,s.jsx)("textarea",{value:f.notes||"",onChange:e=>_({...f,notes:e.target.value}),className:"mt-1 w-full border rounded-lg px-3 py-2",rows:3})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsxs)("div",{className:"p-4 border-b flex justify-between items-center",children:[(0,s.jsx)("span",{className:"font-medium",children:"Itens do or\xe7amento"}),(0,s.jsxs)("button",{onClick:H,className:"bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded flex items-center gap-2",children:[(0,s.jsx)(h.Z,{className:"w-4 h-4"})," Adicionar item"]})]}),(0,s.jsx)("div",{className:"p-4 overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Descri\xe7\xe3o"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Qtd"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Unidade"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Valor unit\xe1rio"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Total"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"A\xe7\xf5es"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:w.map((e,t)=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("input",{value:e.description,onChange:e=>{let a=e.target.value,s=[...w];s[t].description=a,C(s)},className:"w-full border rounded px-2 py-1"})}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("input",{type:"number",value:e.quantity,onChange:e=>{let a=Number(e.target.value),s=[...w];s[t].quantity=a,C(s)},className:"w-full border rounded px-2 py-1"})}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("input",{value:e.unit||"un",onChange:e=>{let a=e.target.value,s=[...w];s[t].unit=a,C(s)},className:"w-full border rounded px-2 py-1"})}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsx)("input",{type:"number",value:e.unit_price,onChange:e=>{let a=Number(e.target.value),s=[...w];s[t].unit_price=a,C(s)},className:"w-full border rounded px-2 py-1"})}),(0,s.jsxs)("td",{className:"px-3 py-2 text-sm",children:["R$ ",(Number(e.unit_price||0)*Number(e.quantity||0)).toFixed(2)]}),(0,s.jsx)("td",{className:"px-3 py-2",children:(0,s.jsxs)("button",{onClick:()=>V(t),className:"text-red-600 hover:text-red-800 flex items-center gap-1",children:[(0,s.jsx)(v.Z,{className:"w-4 h-4"})," Remover"]})})]},e.id||t))})]})}),(0,s.jsxs)("div",{className:"p-4 border-t grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Desconto"}),(0,s.jsx)("input",{type:"number",value:f.discount||0,onChange:e=>_({...f,discount:Number(e.target.value)}),className:"mt-1 w-full border rounded-lg px-3 py-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Taxas"}),(0,s.jsx)("input",{type:"number",value:f.taxes||0,onChange:e=>_({...f,taxes:Number(e.target.value)}),className:"mt-1 w-full border rounded-lg px-3 py-2"})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("div",{className:"text-sm",children:["Subtotal: ",(0,s.jsx)("strong",{children:I.format(O)})]}),(0,s.jsxs)("div",{className:"text-sm",children:["Desconto: ",(0,s.jsx)("strong",{children:I.format(Math.max(0,Math.min(Number((null==f?void 0:f.discount)||0),O)))})]}),(0,s.jsxs)("div",{className:"text-sm",children:["Taxas: ",(0,s.jsx)("strong",{children:I.format(Math.max(0,Number((null==f?void 0:f.taxes)||0)))})]}),(0,s.jsxs)("div",{className:"text-lg",children:["Total: ",(0,s.jsx)("strong",{children:I.format(R)})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-4 border-b flex justify-between items-center",children:(0,s.jsx)("span",{className:"font-medium",children:"Descri\xe7\xe3o das atividades"})}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:S,onChange:e=>A(e.target.value),className:"flex-1 border rounded px-2 py-2",placeholder:"Ex.: Limpeza total do apartamento"}),(0,s.jsx)("button",{onClick:()=>{if(!S.trim())return;let e=Array.isArray(null==f?void 0:f.activities)?[...f.activities]:[];e.push(S.trim()),_({...f,activities:e}),A("")},className:"bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded",children:"Adicionar"})]}),(0,s.jsx)("ul",{className:"list-disc pl-6 space-y-1",children:(Array.isArray(null==f?void 0:f.activities)?f.activities:[]).map((e,t)=>(0,s.jsxs)("li",{className:"flex justify-between items-center",children:[(0,s.jsx)("span",{children:e}),(0,s.jsx)("button",{onClick:()=>_({...f,activities:f.activities.filter((e,a)=>a!==t)}),className:"text-red-600 text-sm",children:"Remover"})]},t))})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsx)("span",{className:"font-medium",children:"Imagens"})}),(0,s.jsxs)("div",{className:"p-4 space-y-3",children:[(0,s.jsx)("input",{type:"file",multiple:!0,onChange:async e=>{let t=e.target.files;if(t&&d.O&&(null==f?void 0:f.id)){E(!0);try{let e=d.O.storage.from("quotes");for(let a of Array.from(t)){let t="".concat(f.id,"/").concat(Date.now(),"-").concat(a.name),{error:s}=await e.upload(t,a,{upsert:!0});if(s)continue;let{data:l}=e.getPublicUrl(t);await fetch("/api/quotes/images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quote_id:f.id,url:l.publicUrl})})}alert("Imagens enviadas")}finally{E(!1)}}}}),(0,s.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:null==f?void 0:null===(e=f.quote_images)||void 0===e?void 0:e.map(e=>(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)("img",{src:e.url,alt:e.caption||"",className:"w-full h-24 object-cover rounded"})},e.id))})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-4 border-b",children:(0,s.jsx)("span",{className:"font-medium",children:"M\xe9todos de pagamento"})}),(0,s.jsx)("div",{className:"p-4 grid grid-cols-2 md:grid-cols-4 gap-2",children:["pix","transferencia","cartao","dinheiro"].map(e=>(0,s.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:T.includes(e),onChange:t=>Z(a=>t.target.checked?[...a,e]:a.filter(t=>t!==e))}),(0,s.jsx)("span",{className:"capitalize",children:e})]},e))})]}),(0,s.jsx)(y.Z,{context:{titulo:null==f?void 0:f.title,cliente:(null==f?void 0:f.customers)||void 0,servico:(null==f?void 0:f.services)||void 0,residencia:null==f?void 0:f.residence_type,area_m2:null==f?void 0:f.area_m2,modalidade:null==f?void 0:f.service_modality,valid_until:(null==f?void 0:f.valid_until)||null,itens:w.map(e=>({description:e.description,quantity:e.quantity,unit:e.unit||"un",unit_price:e.unit_price})),subtotal:O,total:R},onSetValidUntil:e=>_(t=>({...t,valid_until:e})),onAddItem:e=>C(t=>[...t,{id:"",description:e.description,quantity:e.quantity,unit:e.unit||"un",unit_price:e.unit_price,total:Number(e.unit_price||0)*Number(e.quantity||0)}]),onSetTemplateAppend:e=>M(t=>(t||"")+e),onSetActivities:e=>_(t=>({...t,activities:e})),onSetContractTerms:e=>_(t=>({...t,contract_terms:e})),onSetPaymentMethods:e=>Z(e)})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(r.default,{href:"/orcamentos",className:"text-blue-600 hover:text-blue-800 flex items-center gap-1",children:[(0,s.jsx)(c.Z,{className:"w-4 h-4"})," Voltar"]}),(0,s.jsx)("div",{className:"text-gray-600",children:"Or\xe7amento n\xe3o encontrado."})]})}}},function(e){e.O(0,[46,170,138,955,971,23,744],function(){return e(e.s=1932)}),_N_E=e.O()}]);