(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{867:function(e,t,a){Promise.resolve().then(a.bind(a,1730))},1730:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return x}});var s=a(7437),r=a(2265),n=a(8493);function d(){let[e,t]=(0,r.useState)(!1),[a,n]=(0,r.useState)(""),[d,l]=(0,r.useState)(!1),[i,c]=(0,r.useState)([]),[o,m]=(0,r.useState)(""),x=(0,r.useRef)(null);(0,r.useEffect)(()=>{o||m(crypto.randomUUID())},[o]),(0,r.useEffect)(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[i]);let g=(0,r.useMemo)(()=>({page:"dashboard"}),[]),h=()=>{c(e=>[...e,{role:"assistant",content:""}])},p=e=>{c(t=>{let a=[...t],s=a[a.length-1];return s&&"assistant"===s.role?s.content=String(s.content||"")+e:a.push({role:"assistant",content:e}),a})},u=e=>{if(!e)return},y=async e=>{let t=(null!=e?e:a).trim();if(t){c([...i,{role:"user",content:t}]),l(!0),n("");try{let e=await fetch("/api/chatbot/assistant",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:o,messages:[{role:"user",content:t}],context:g})}),a=e.headers.get("Content-Type")||"";if(e.body&&!a.includes("application/json")){h();let t=e.body.getReader(),a=new TextDecoder;for(;;){let{value:e,done:s}=await t.read();if(s)break;p(a.decode(e))}}else{let t=await e.json().catch(()=>null),a=String((null==t?void 0:t.reply)||"Sem resposta no momento.");c(e=>[...e,{role:"assistant",content:a,actions:null==t?void 0:t.actions}])}}catch(e){c(e=>[...e,{role:"assistant",content:"Falha ao responder. Tente novamente."}])}finally{l(!1)}}};return(0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-50",children:e?(0,s.jsxs)("div",{className:"w-[360px] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("span",{className:"font-medium",children:"Assistente do CRM"}),(0,s.jsx)("button",{onClick:()=>t(!1),className:"text-gray-500",children:"âœ•"})]}),(0,s.jsx)("div",{className:"px-3 py-2 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:["Resumo financeiro do m\xeas","Quais pend\xeancias de agendamento hoje?","Criar cliente com nome e telefone","Gerar fatura para \xfaltimo servi\xe7o conclu\xeddo","Enviar lembrete de pagamento para faturas em atraso"].map(e=>(0,s.jsx)("button",{onClick:()=>y(e),className:"text-xs bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-100 px-2 py-1 rounded",children:e},e))})}),(0,s.jsxs)("div",{ref:x,className:"h-72 overflow-y-auto px-3 py-2 space-y-2",children:[i.map((e,t)=>(0,s.jsxs)("div",{className:"user"===e.role?"text-right":"text-left",children:[(0,s.jsx)("div",{className:"inline-block px-3 py-2 rounded ".concat("user"===e.role?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-700 dark:text-gray-100"),children:e.content}),"assistant"===e.role&&e.actions&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("button",{onClick:()=>u(e.actions),className:"text-sm bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-gray-100 px-2 py-1 rounded",children:"Aplicar a\xe7\xe3o"})})]},t)),0===i.length&&(0,s.jsx)("div",{className:"text-sm text-gray-500",children:"Fa\xe7a perguntas de opera\xe7\xf5es, finan\xe7as, agenda e clientes."})]}),(0,s.jsx)("div",{className:"px-3 py-2 border-t border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:a,onChange:e=>n(e.target.value),placeholder:"Digite sua pergunta",className:"flex-1 border rounded px-2 py-2"}),(0,s.jsx)("button",{onClick:()=>y(),disabled:d,className:"bg-blue-600 text-white px-3 py-2 rounded",children:d?"...":"Enviar"})]})})]}):(0,s.jsx)("button",{onClick:()=>t(!0),className:"bg-blue-600 text-white px-4 py-2 rounded-lg shadow",children:"Assistente"})})}var l=a(1240),i=a(4241),c=a(1077),o=a(3225);function m(){let[e,t]=(0,r.useState)({totalCustomers:0,totalAppointments:0,monthlyRevenue:0,pendingAppointments:0,totalEmployees:0}),[a,m]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[h,p]=(0,r.useState)(!0);(0,r.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=await (0,n.OL)(),a=await (0,n.By)(),s=await (0,n.fN)(),r=e.length,d=a.length,l=s.length,i=new Date().toISOString().slice(0,7),c=a.filter(e=>"completed"===e.status&&e.appointment_date.startsWith(i)).reduce((e,t)=>e+Number(t.price||0),0),o=a.filter(e=>["scheduled","confirmed"].includes(e.status)).length,x=(await (0,n.Ts)()||[]).sort((e,t)=>new Date(t.appointment_date).getTime()-new Date(e.appointment_date).getTime()).slice(0,5).map(e=>{var t,a;return{id:e.id,appointment_date:e.appointment_date,appointment_time:e.appointment_time,status:e.status,customer:{name:(null===(t=e.customers)||void 0===t?void 0:t.name)||""},service:{name:(null===(a=e.services)||void 0===a?void 0:a.name)||""}}}),h=(s||[]).sort((e,t)=>new Date(t.createdAt||t.created_at||0).getTime()-new Date(e.createdAt||e.created_at||0).getTime()).slice(0,5).map(e=>({id:e.id,name:e.name,position:e.position,active:!!e.active,createdAt:e.createdAt||e.created_at||null}));t({totalCustomers:r||0,totalAppointments:d||0,monthlyRevenue:c,pendingAppointments:o,totalEmployees:l||0}),m(x||[]),g(h||[])}catch(e){console.error("Erro ao buscar dados do dashboard:",e)}finally{p(!1)}};return h?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6",children:[(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(l.Z,{className:"h-8 w-8 text-blue-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Clientes"}),(0,s.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:e.totalCustomers})]})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(i.Z,{className:"h-8 w-8 text-green-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Agendamentos"}),(0,s.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:e.totalAppointments})]})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(c.Z,{className:"h-8 w-8 text-yellow-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Receita Mensal"}),(0,s.jsxs)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:["R$ ",e.monthlyRevenue.toLocaleString("pt-BR")]})]})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(o.Z,{className:"h-8 w-8 text-purple-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Pendentes"}),(0,s.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:e.pendingAppointments})]})]})}),(0,s.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(l.Z,{className:"h-8 w-8 text-indigo-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Funcion\xe1rios"}),(0,s.jsx)("p",{className:"text-2xl font-semibold text-gray-900 dark:text-gray-100",children:e.totalEmployees})]})]})})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Pr\xf3ximos Agendamentos"})}),(0,s.jsx)("div",{className:"p-6",children:0===a.length?(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"Nenhum agendamento recente"}):(0,s.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.customer.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.service.name})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:new Date(e.appointment_date).toLocaleDateString("pt-BR")}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.appointment_time})]})]},e.id))})})]}),(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:"Funcion\xe1rios Recentes"})}),(0,s.jsx)("div",{className:"p-6",children:0===x.length?(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400 text-center py-4",children:"Nenhum funcion\xe1rio cadastrado"}):(0,s.jsx)("div",{className:"space-y-4",children:x.map(e=>(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.position})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.active?"Ativo":"Inativo"}),e.createdAt&&(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:new Date(e.createdAt).toLocaleDateString("pt-BR")})]})]},e.id))})})]}),(0,s.jsx)(d,{})]})}function x(){return(0,s.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900",children:(0,s.jsx)(m,{})})}}},function(e){e.O(0,[46,170,686,971,23,744],function(){return e(e.s=867)}),_N_E=e.O()}]);